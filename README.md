# Задание 3: Локальный чатик (только Go)

**Студент Ву Хоанг Ань**

**Группа 932101**

# Задание:

Разработать приложение для создания локального чата на Go, которое может работать как сервер, так и клиент в зависимости от переданных аргументов при запуске. Клиент подключается к серверу по указанному IP-адресу и порту, отправляет никнейм при первом подключении и может отправлять личные или общие сообщения.

# Функциональные возможности

Режим сервера:
* Принимает подключения и сохраняет никнеймы клиентов.
* Пересылает сообщения конкретному пользователю на основе @username.
* Если имя получателя не указано, сообщение отправляется всем подключённым пользователям.
* Обрабатывает отключения клиентов и не отправляет сообщения отключённым пользователям.

Режим клиента:
* Подключается к серверу по указанному IP-адресу и порту.
* Отправляет никнейм как первое сообщение.
* Отправляет личные сообщения с использованием @имя_пользователя или общие сообщения, если получатель не указан.
* Отображает сообщения, полученные от сервера.

# Используемые технологии

Язык: Go

Сетевой протокол: TCP (Transmission Control Protocol)

Формат передачи данных: Передача байтов

# Файл

* main.go: Основной файл приложения, обрабатывает аргументы командной строки для определения режима работы (сервер или клиент).
* server.go: Реализует работу сервера, управляет подключениями клиентов и пересылкой сообщений.
* client.go: Реализует работу клиента, подключается к серверу и обрабатывает отправку и получение сообщений.

# main.go

1.	Чтение аргументов командной строки.
2.	Если первый аргумент — server, запускается сервер с указанным портом.
3.	Если первый аргумент — client, запускается клиент с указанными параметрами (IP-адрес сервера, порт и никнейм).
4.	В случае некорректных аргументов выводится сообщение об ошибке и инструкция по запуску.

# server.go

1. Запуск сервера:
* Слушает подключение на заданном порту (net.Listen).
* Для каждого нового подключения запускается отдельный горутин для обработки.
2. Регистрация клиента:
* Считывает первый отправленный клиентом пакет данных — никнейм.
* Сохраняет никнейм и объект соединения в мапу clients.
3. Обработка сообщений:
* Принимает сообщения и проверяет наличие префикса @username.
* Если префикс присутствует, сообщение перенаправляется указанному пользователю.
* Если префикса нет, сообщение рассылается всем пользователям.
4. Отключение клиента:
* Если соединение клиента разрывается, сервер удаляет его из списка активных клиентов.

Основные функции сервера:
* handleClient(conn net.Conn) – обрабатывает подключение конкретного клиента.
* sendToSpecificClient(username string, message string) – отправляет сообщение конкретному пользователю.
* broadcastMessage(message string) – отправляет сообщение всем подключённым клиентам.

# client.go
1. Подключение к серверу:
* Устанавливает соединение с сервером по указанному IP-адресу и порту (net.Dial).
* Отправляет никнейм клиента серверу.
2. Отправка сообщений:
* В бесконечном цикле считывает ввод пользователя и отправляет его на сервер.
* Поддерживается формат сообщений вида @username текст сообщения для личных сообщений.
* Сообщения без префикса отправляются всем пользователям.
3. Получение сообщений:
* В отдельной горутине происходит непрерывное чтение сообщений, полученных от сервера.
* Полученные сообщения выводятся на экран.

Основные функции клиента:
* RunClient(address string, username string) – устанавливает соединение с сервером и запускает горутины для отправки и получения сообщений и обрабатывает ввод пользователя и отправляет сообщения серверу.
* receiveMessages(conn net.Conn) – принимает сообщения от сервера и выводит их на экран.

# Инструкция по сборке и запуску

1. **Реализация модуля для приложение:**
```
go mod init lab3 (или другое имя)
```

2. **Сборка программы:**
```
go build -o chat
```
После успешной сборки появится исполняемый файл сhat

3. **Запуск сервера:**

Откройте первый терминал и запустите сервер
```
./chat -mode=server -port=8080
```
Отобразится сообщение:
```
Server is running at 127.0.0.1:8080
```

4. **Запуск клиента**

Откройте второй терминал и запустите первого клиента:
```
./chat -mode=client -username=User1 -port=8080
```
Откройте третий терминал и запустите второго клиента:
```
./chat -mode=client -username=User2 -port=8080
```
Появится сообщение:
```
Successfully connected to server.
```
Server:
```
User1 is connected.
User2 is connected.
```

5. **Отправка сообщений**

User1 отправляет личное сообщение User2:
```
@User2 hello
```

User2 отправляет сообщение всем пользователям:
```
hi!
```
